!(function(C) {
  "use strict";
  C(document).ready(function() {
    var a = livepreviewpro_globals,
      i = window.history,
      g = [],
      d = null,
      o = null,
      s = null,
      r = 1;
    if (
      (C("#product-list .product").each(function(a, t) {
        var e = C(t);
        e.detach(),
          g.push(e),
          e.hasClass("active") && (r = Math.floor(a / 4) + 1);
      }),
      /^((?!chrome|android).)*safari/i.test(navigator.userAgent))
    ) {
      C(".iframe-wrap").css({
        "-webkit-overflow-scrolling": "touch",
        "overflow-y": "auto"
      }),
        C("#product-devices").css({
          display: "none"
        });
      var t = C("body").width();
      C("#iframe")
        .attr("scrolling", "no")
        .removeClass("iframe")
        .css({
          position: "absolute",
          top: 0,
          left: 0,
          "min-width": "100%",
          "min-height": "100%"
        })
        .width(t);
    }

    function l(a, t, e) {
      var i = C("#product-list"),
        d = C("#pagination"),
        o = null,
        s = 0;
      i.empty();
      for (var r = 0; r < g.length; r++) {
        var l = C("<div></div>").addClass("col-xs-6 col-sm-3"),
          n = g[r],
          c = n.data("product");
        (null != a && "*" != a && c.tag.toLowerCase() != a.toLowerCase()) ||
          ((null != t && "*" != t && c.year != t) ||
            (e && -1 == c.title.toLowerCase().indexOf(e.toLowerCase())) ||
            (s % 4 == 0 &&
              (i.append(o), (o = C("<div></div>").addClass("row"))),
            o.append(l.append(n)),
            s++));
      }
      i.append(o),
        C("#filters a.active").removeClass("active"),
        C('#filters a[data-tag="' + a + '"]').addClass("active"),
        C('#filters a[data-year="' + t + '"]').addClass("active");
      var p = C("#filters a.active").closest(".has-child");
      p.length && p.find("> a").addClass("active"), d.empty();
      var u = i.find(".row"),
        v = C("<ul></ul>"),
        f = C("<li></li>")
          .addClass("nav prev")
          .attr("data-page", "prev")
          .append(
            C("<a></a>")
              .attr("href", "#")
              .append(C("<i></i>").addClass("fa fa-angle-left"))
          ),
        h = C("<li></li>")
          .addClass("nav next")
          .attr("data-page", "next")
          .append(
            C("<a></a>")
              .attr("href", "#")
              .append(C("<i></i>").addClass("fa fa-angle-right"))
          );
      u.length <= 1 ||
        (v.append(f),
        u.each(function(a, t) {
          var e = C("<li></li>")
            .addClass("hidden-xs")
            .attr("data-page", a + 1)
            .append(
              C("<a></a>")
                .attr("href", "#")
                .text(a + 1)
            );
          v.append(e);
        }),
        v.append(h),
        d.append(v));
    }

    function n(i) {
      C("#product-list .row")
        .removeClass("active show")
        .each(function(a, t) {
          if (a + 1 == i) {
            var e = C(t);
            return (
              e.addClass("active"),
              e.get(0).offsetHeight,
              e.addClass("show"),
              e.find(".product img").lazyload(),
              !1
            );
          }
        }),
        C("#pagination li").removeClass("active"),
        C('#pagination li[data-page="' + i + '"]').addClass("active"),
        C("#product-list .title span").ellipsis({
          row: 2
        });
    }

    function e(a) {
      var t = C("#iframe");
      a = a || "desktop";
      C("#product-devices a.active").removeClass("active"),
        C('#product-devices a[data-device="' + a + '"]').addClass("active"),
        "desktop" == a ? t.removeClass("border") : t.addClass("border"),
        t
          .removeClass(
            "desktop tabletlandscape tabletportrait mobilelandscape mobileportrait"
          )
          .addClass(a);
    }

    function c(e) {
      !(function(a) {
        if (
          a &&
          (a.preload
            ? C("body").removeClass("iframe-loaded")
            : C("body").addClass("iframe-loaded"),
          C("#product-name").text(a.title),
          C("#iframe")[0].contentWindow.location.replace(a.url),
          C("#product-frame-close").attr("href", a.url),
          C("#buy")
            .attr("href", a.buy)
            .css({
              display: a.buy ? "" : "none"
            }),
          i.enabled && e)
        ) {
          var t = C.query.set("product_id", a.id);
          i.pushState(
            {
              product_id: a.id
            },
            null,
            t.toString()
          );
        }
      })(C("#product-list .product.active").data("product"));
    }

    function p() {
      var a = C("#product-toggle");
      a.toggleClass("active"),
        a.hasClass("active")
          ? (C("body").addClass("products-active"),
            C("#product-list .title span").ellipsis({
              row: 2
            }))
          : C("body").removeClass("products-active");
    }

    function u() {
      C("#filters li.dropdown").removeClass("dropdown");
    }
    C("#product-toggle").on("click", function() {
      p();
    }),
      C("#product-devices a").on("click", function() {
        return e(C(this).data("device")), !1;
      }),
      C("#filter-tags a").on("click", function() {
        var a = C(this),
          t = a.closest("li"),
          e = a.data("tag");
        return (
          t.hasClass("has-child")
            ? t.toggleClass("dropdown")
            : ((r = 1), l((d = e), (o = null), s), n(r)),
          !1
        );
      }),
      C("#filter-search input").on("input", function(a) {
        (s = C(this).val()), (r = 1), l(d, o, s), n(r);
      }),
      C("#filter-years a").on("click", function() {
        var a = C(this),
          t = a.closest("li"),
          e = a.data("year");
        return (
          t.hasClass("has-child")
            ? t.toggleClass("dropdown")
            : ((r = 1), l((d = null), (o = e), s), n(r)),
          !1
        );
      }),
      C("body").on("click", function() {
        u();
      }),
      C("#products").on("click", function(a) {
        C(a.target).is(C("#products")) && p();
      }),
      C("#pagination").on("click", "a", function() {
        var a = C(this)
            .closest("li")
            .data("page"),
          t = C("#product-list .row").length;
        return (
          (r = 0 < a ? a : r),
          (r = "prev" == a ? r - 1 : r),
          (r = "next" == a ? r + 1 : r),
          n((r = Math.min(Math.max(r, 1), t))),
          !1
        );
      }),
      C("#product-list").on("click", ".product", function() {
        var a = C(this);
        return (
          C("#product-list .product.active").removeClass("active"),
          a.addClass("active"),
          u(),
          c(!0),
          p(),
          !1
        );
      }),
      C("#iframe").on("load", function(a) {
        setTimeout(function() {
          C("body").addClass("iframe-loaded");
        }, 1e3);
      }),
      i.enabled &&
        i.Adapter.bind(window, "statechange", function() {
          var a = i.getState();
          if (a.data && a.data.product_id) {
            var t = C(
              "#product-list .product[data-product-id='" +
                a.data.product_id +
                "']"
            );
            t.hasClass("active") ||
              (C("#product-list .product.active").removeClass("active"),
              t.addClass("active"),
              c(!1));
          }
        }),
      l(d, o),
      n(r),
      e(a.responsiveDevice),
      C(".page-loader").length
        ? setTimeout(function() {
            C("body").addClass("page-loaded"), c(!0);
          }, 3e3)
        : (C("body").addClass("page-loaded"), c(!0));
  });
})(jQuery);
